<!DOCTYPE html>
<html ng-app="ut4waApp">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>UT4 Web Administration</title>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		
		<script src="js/angular164.min.js"></script>
		<script src="js/ng-module.js"></script>
		
		<!-- BOOTSTRAP 3 -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		
		<link rel="stylesheet" href="css/style.css">
	</head>
	
	<body>
		<div id="top-menu">
			<img class="left" src="/img/ut4_logo.png"/>
			<h1 id="server_name"></h1>
			<h2 id="server_motd"></h2>
		</div>
		<div class="content">
			<div class="leftPanel">
				<ul class="nav nav-pills nav-stacked">
				  <li role="presentation" class="active"><a href="#" onclick="javascript:loadPage('gameinfo.html')">Current Game</a></li>
				  <li role="presentation" onclick="javascript:loadPage('admin.html')"><a href="#">Administration</a></li>
				  <li role="presentation" onclick="javascript:logout()"><a href="#">Log Out</a></li>
				</ul>
			</div>
			<div class="centerPanel" id="centerContent">
				<div ng-controller="GameInfoController as giCtrl">
					<div ng-if="!hasMatches">
					NO MATCHS!
					</div>
					<div ng-if="hasMatches">
						<div ng-repeat="lobbyInstance in GameInstancesLightData">
							<!-- Game info from parent lobby server -->
							<!-- Less info and less reliable data since it's partial data and replicated from instanced server to lobby -->
							<div class="panel panel-primary">
							  <div class="panel-heading">
								<h3 class="panel-title">{{lobbyInstance.CustomGameName}} - {{lobbyInstance.Ruleset.Title}} - {{lobbyInstance.MatchUpdate.MatchState}} - {{lobbyInstance.NumPlayersInMatch}} / {{lobbyInstance.Ruleset.MaxPlayers}} player(s)</h3>
							  </div>
							  <div class="panel-body">
								<div>
									<div class="row">
									  <div class="col-sm-6 col-md-4">
										<div class="thumbnail">
										  <img ng-src="/img/maps/{{lobbyInstance.MapInfo.Title}}.png">
										  <div class="caption">
											<h3>{{lobbyInstance.MapInfo.Title}}</h3>
											<p>{{lobbyInstance.MapInfo.Author}}</p>
											Switch to:
											<select>
												<!-- TODO red background color if map is not from epic and has no redirectUrl set -->
												<option ng-repeat="mapInfo in lobbyInstance.Ruleset.MapList">{{mapInfo.MapAssetName}}</option>
											</select>
											
										  </div>
										</div>
									  </div>
										<div>
											<h1>Time: {{toMinutesSec(lobbyInstance.MatchUpdate.GameTime)}} / {{toMinutesSec(lobbyInstance.MatchUpdate.TimeLimit)}}</h1>
										</div>
										<div ng-if="lobbyInstance.MatchUpdate.GoalScore > 0">
											<h1>Goal Score: {{lobbyInstance.MatchUpdate.GoalScore}}</h1>
										</div>
									</div>
									<table class="table">
										<thead>
											<tr>
												<th>Name</th>
												<th>Id</th>
												<th>Score</th>
												<th>XP</th>
												<th>Spec?</th>
												<th>Action</th>
											</tr>
										</thead>
										<tbody>
											<tr ng-repeat="player in lobbyInstance.AvailablePlayers"
												ng-class="{ 'redTeam': (player.TeamNum == 0 && !player.bIsSpectator), 'blueTeam': (player.TeamNum == 1 && !player.bIsSpectator )}"
												>
												<td>{{player.PlayerName}}</td>
												<td>{{player.PlayerID}}</td>
												<td class="textRight">{{player.PlayerScore}}</td>
												<td class="textRight">{{player.XPLevel}}</td>
												<td><span ng-if="player.bIsSpectator">X</span></td>
												<td>
													<button ng-click="kickPlayer(lobbyInstance, player.PlayerID, false, false)">KICK</button>
													<button ng-click="kickPlayer(lobbyInstance, player.PlayerID, true, false)">BAN</button>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							  </div>
							</div>
						</div>
						<!-- FULL DATA -->
						<!-- DISABLED FOR THE MOMENT NEED TO DEFINE A COMMON JSON STRUCTURE FOR BOTH DEDI/LOBBY INSTANCES
						<div ng-repeat="dediInstance in GameInstancesFullData">
							<div class="panel panel-primary">
								<div class="panel-heading">
									<h3 class="panel-title">{{dediInstance.ServerName}} - {{dediInstance.Ruleset.Title}} - {{dediInstance.MatchState}} - {{dediInstance.NumPlayers}} / {{dediInstance.MaxPlayers}} player(s)</h3>
								</div>
								<div class="panel-body">
									<div class="row">
									  <div class="col-sm-6 col-md-4">
										<div class="thumbnail">
										  <img ng-src="/img/maps/{{lobbyInstance.MapInfo.Title}}.png">
										  <div class="caption">
											<h3>{{lobbyInstance.MapInfo.Title}}</h3>
											<p>{{lobbyInstance.MapInfo.Author}}</p>
											Switch to:
											<select>
												<option ng-repeat="mapInfo in dediInstance.MapList">{{mapInfo.MapAssetName}}</option>
											</select>
											
										  </div>
										</div>
									  </div>
										<div>
											<h1>Time: {{toMinutesSec(dediInstance.ElapsedTime)}} / {{toMinutesSec(dediInstance.TimeLimit)}}</h1>
										</div>
										<div ng-if="dediInstance.GoalScore > 0">
											<h1>Goal Score: {{dediInstance.GoalScore}}</h1>
										</div>
									</div>
									<table class="table">
										<thead>
											<tr>
												<th>Name</th>
												<th>Id</th>
												<th>Score</th>
												<th>K</th>
												<th>D</th>
												<th>Spec?</th>
												<th>IP</th>
											</tr>
										</thead>
										<tbody>
											<tr ng-repeat="player in dediInstance.Players"
												ng-class="{ 'redTeam': (player.TeamNum == 0 && !player.bIsSpectator), 'blueTeam': (player.TeamNum == 1 && !player.bIsSpectator )}"
												>
												<td>{{player.ClanName}} {{player.PlayerName}}</td>
												<td>{{player.UniqueID}}</td>
												<td class="textRight">{{player.Score}}</td>
												<td class="textRight">{{player.Kills}}</td>
												<td class="textRight">{{player.Deaths}}</td>
												<td><span ng-if="player.bIsSpectator">X</span></td>
												<td>{{player.SavedNetworkAddress}}</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						-->
					</div>
				</div>
			</div>
		</div>

		
		<script type="text/javascript">
			$( document ).ready(function() {
				loadServerInfo();
			});
		
			function loadPage(page)
			{
				page = "/" + page;
				
				$("#centerContent").load(page, function(responseTxt, statusTxt, xhr){
					console.log(xhr);
				});
			}
			
			function logout(){
				document.execCommand("ClearAuthenticationCache");
				window.location = 'http://logout@'+window.location.host;
			}
			
			function loadServerInfo(){
				$.getJSON( "serverinfo", function( data ) {
					$('#server_name').html(data.ServerName);
					$('#server_motd').html(data.ServerMOTD);
					$('#server_description').html(data.ServerDescription);
				});
			}
		</script>
	</body>
</html>