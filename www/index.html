<!DOCTYPE html>
<html ng-app="ut4waApp">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>UT4 Web Administration</title>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		
		<script src="js/angular164.min.js"></script>
		<script src="js/ng-module.js"></script>
		
		<!-- BOOTSTRAP 3 -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		
		<link rel="stylesheet" href="css/style.css">
	</head>
	
	<body>
		<div id="top-menu">
			<img class="left" src="/img/ut4_logo.png"/>
			<h1 id="server_name"></h1>
			<h4 id="server_motd"></h4>
		</div>
		<div class="content">
			<div class="leftPanel">
				<ul class="nav nav-pills nav-stacked">
				  <li role="presentation" class="active"><a href="#" onclick="javascript:loadPage('gameinfo.html')">Current Game</a></li>
				  <li role="presentation" onclick="javascript:loadPage('admin.html')"><a href="#">Administration</a></li>
				  <li role="presentation" onclick="javascript:logout()"><a href="#">Log Out</a></li>
				</ul>
			</div>
			<div class="centerPanel" id="centerContent">
				<div ng-controller="GameInfoController as giCtrl">
					<div ng-if="!hasMatches">
					NO MATCHS!
					</div>
					<div ng-if="hasMatches">
						<div ng-repeat="lobbyInstance in GameInstances">
							<!-- Game info from parent lobby server -->
							<!-- Less info and less reliable data since it's partial data and replicated from instanced server to lobby -->
							<div class="panel panel-primary">
							  <div class="panel-heading">
								<h3 class="panel-title">{{lobbyInstance.ServerName}} - {{lobbyInstance.Ruleset.Title}} - {{lobbyInstance.MatchState}} - {{lobbyInstance.NumPlayers}} / {{lobbyInstance.MaxPlayers}} player(s)</h3>
							  </div>
							  <div class="panel-body">
								<div>
									<div class="row">
									  <div class="col-sm-6 col-md-4">
										<div class="thumbnail">
										  <img ng-src="/img/maps/{{lobbyInstance.Map.Title}}.png">
										  <div class="caption">
											<h3>{{lobbyInstance.Map.Title}}</h3>
											<p>{{lobbyInstance.Map.Author}}</p>
											Switch to:
											<select>
												<!-- TODO red background color if map is not from epic and has no redirectUrl set -->
												<option ng-repeat="mapInfo in lobbyInstance.MapList">{{mapInfo.MapAssetName}}</option>
											</select>
											
										  </div>
										</div>
									  </div>
										<div>
											<h1>Time: {{toMinutesSec(lobbyInstance.ElapsedTime)}} / {{toMinutesSec(lobbyInstance.TimeLimit)}}</h1>
										</div>
										<div ng-if="lobbyInstance.GoalScore > 0">
											<h1>Goal Score: {{lobbyInstance.GoalScore}}</h1>
										</div>
									</div>
									
									<!-- PLAYERS -->
									<!-- Light data from lobby -->
									<table class="table">
										<thead>
											<tr>
												<th>Name</th>
												<th>Id</th>
												<th ng-if="lobbyInstance.IsDataFromDedi">IP</th>
												<th>Score</th>
												<th ng-if="lobbyInstance.IsDataFromDedi">K</th>
												<th ng-if="lobbyInstance.IsDataFromDedi">D</th>
												<th ng-if="lobbyInstance.IsDataFromDedi">Ping</th>
												<th>XP</th>
												<th>Spec?</th>
												<th>Action</th>
											</tr>
										</thead>
										<tbody>
											<tr ng-repeat="player in lobbyInstance.Players"
												ng-class="{ 'redTeam': (player.TeamNum == 0 && !player.bIsSpectator), 'blueTeam': (player.TeamNum == 1 && !player.bIsSpectator )}"
												>
												<td>{{player.PlayerName}}</td>
												<td><span ng-if="!player.bIsABot">{{player.UniqueId}}</span></td>
												<td>{{player.SavedNetworkAddress}}</td>
												<td class="textRight">{{player.PlayerScore}}</td>
												<td class="textRight" ng-if="lobbyInstance.IsDataFromDedi">{{player.Kills}}</td>
												<td class="textRight" ng-if="lobbyInstance.IsDataFromDedi">{{player.Deaths}}</td>
												<th class="textRight" ng-if="lobbyInstance.IsDataFromDedi"><span ng-if="!player.bIsABot">{{player.Ping}}</span></th>
												<td class="textRight">{{player.XPLevel}}</td>
												<td><span ng-if="player.bIsSpectator">X</span></td>
												<td>
													<button ng-click="kickPlayer(lobbyInstance, player, false, false)">K</button>
													<button ng-click="kickPlayer(lobbyInstance, player, true, false)">B</button>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							  </div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		
		<script type="text/javascript">
			$( document ).ready(function() {
				loadServerInfo();
			});
		
			function loadPage(page)
			{
				page = "/" + page;
				
				$("#centerContent").load(page, function(responseTxt, statusTxt, xhr){
					console.log(xhr);
				});
			}
			
			function logout(){
				document.execCommand("ClearAuthenticationCache");
				window.location = 'http://logout@'+window.location.host;
			}
			
			function loadServerInfo(){
				$.getJSON( "serverinfo", function( data ) {
					$('#server_name').html(data.ServerName);
					$('#server_motd').html(data.ServerMOTD);
					$('#server_description').html(data.ServerDescription);
				});
			}
		</script>
	</body>
</html>